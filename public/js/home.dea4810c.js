(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["home"],{"4d63":function(e,t,i){var r=i("83ab"),n=i("da84"),a=i("94ca"),s=i("7156"),o=i("9bf2").f,c=i("241c").f,d=i("44e7"),l=i("ad6d"),u=i("9f7f"),p=i("6eeb"),f=i("d039"),v=i("69f3").set,b=i("2626"),y=i("b622"),m=y("match"),h=n.RegExp,w=h.prototype,g=/a/g,_=/a/g,k=new h(g)!==g,E=u.UNSUPPORTED_Y,S=r&&a("RegExp",!k||E||f((function(){return _[m]=!1,h(g)!=g||h(_)==_||"/a/i"!=h(g,"i")})));if(S){var x=function(e,t){var i,r=this instanceof x,n=d(e),a=void 0===t;if(!r&&n&&e.constructor===x&&a)return e;k?n&&!a&&(e=e.source):e instanceof x&&(a&&(t=l.call(e)),e=e.source),E&&(i=!!t&&t.indexOf("y")>-1,i&&(t=t.replace(/y/g,"")));var o=s(k?new h(e,t):h(e,t),r?this:w,x);return E&&i&&v(o,{sticky:i}),o},C=function(e){e in x||o(x,e,{configurable:!0,get:function(){return h[e]},set:function(t){h[e]=t}})},R=c(h),U=0;while(R.length>U)C(R[U++]);w.constructor=x,x.prototype=w,p(n,"RegExp",x)}b("RegExp")},"5ced":function(e,t,i){},7156:function(e,t,i){var r=i("861d"),n=i("d2bb");e.exports=function(e,t,i){var a,s;return n&&"function"==typeof(a=t.constructor)&&a!==i&&r(s=a.prototype)&&s!==i.prototype&&n(e,s),e}},a640:function(e,t,i){"use strict";var r=i("d039");e.exports=function(e,t){var i=[][e];return!!i&&r((function(){i.call(null,t||function(){throw 1},1)}))}},ae40:function(e,t,i){var r=i("83ab"),n=i("d039"),a=i("5135"),s=Object.defineProperty,o={},c=function(e){throw e};e.exports=function(e,t){if(a(o,e))return o[e];t||(t={});var i=[][e],d=!!a(t,"ACCESSORS")&&t.ACCESSORS,l=a(t,0)?t[0]:c,u=a(t,1)?t[1]:void 0;return o[e]=!!i&&!n((function(){if(d&&!r)return!0;var e={length:-1};d?s(e,1,{enumerable:!0,get:c}):e[1]=1,i.call(e,l,u)}))}},bb51:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"home"},[i("div",{staticClass:"login-7 tab-box"},[i("div",{staticClass:"container-fluid"},[i("div",{staticClass:"row"},[e.address?i("div",{},[e.success?e._e():i("div",{staticClass:"login-inner-form"},[i("div",{staticClass:"details"},[i("h1",[e._v("Link a Digital Identity")]),i("br"),e._v("to "+e._s(e.address)),i("br"),i("br"),i("div",{staticClass:"columns",class:{isGithub:e.isGithub,isGoogle:e.isGoogle,isTwitter:e.isTwitter,isLinkedin:e.isLinkedin,isEmail:e.isEmail,isPhone:e.isPhone,isEid:e.isEid}},e._l(e.providers,(function(t){return i("div",{key:t,staticClass:"column is-one-third-mobile",on:{click:function(i){return e.selectProvider(t)}}},[i("div",{class:"card is-"+t,staticStyle:{cursor:"pointer"}},[i("div",{staticClass:"card-content"},[i("img",{attrs:{src:"/"+t+".png",width:"100%"}})]),i("footer",{staticClass:"card-footer"},[i("p",{staticClass:"card-footer-item"},[i("span",[e._v(" "+e._s(t.toUpperCase())+" ")])])])])])})),0),i("form",{attrs:{id:"verificationForm",action:e.backendURL+"/auth/"+e.provider,method:"GET"}},[i("br"),"email"===e.provider&&!1===e.showEmailVerification?i("div",{staticClass:"form-group"},[e._v(" Insert your e-mail to continue:"),i("br"),i("br"),i("b-input",{attrs:{type:"email",placeholder:"Insert E-Mail"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),i("br")],1):e._e(),"phone"===e.provider&&!1===e.showSmsVerification?i("div",{staticClass:"form-group"},[e._v(" Insert your phone number to continue:"),i("br"),i("br"),i("b-input",{attrs:{placeholder:"Insert Phone number"},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}}),i("br"),i("small",[e._v("Insert the country prefix before (ex +393331122333)")]),i("br"),i("br")],1):e._e(),"phone"===e.provider&&!0===e.showSmsVerification?i("div",{staticClass:"form-group"},[e._v(" Insert the OTP received by SMS:"),i("br"),i("br"),i("b-input",{attrs:{placeholder:"Insert code"},model:{value:e.smsverification,callback:function(t){e.smsverification=t},expression:"smsverification"}}),i("br")],1):e._e(),"email"===e.provider&&!0===e.showEmailVerification?i("div",{staticClass:"form-group"},[e._v(" Insert the OTP received by E-Mail:"),i("br"),i("br"),i("b-input",{attrs:{placeholder:"Insert code"},model:{value:e.emailverification,callback:function(t){e.emailverification=t},expression:"emailverification"}}),i("br")],1):e._e(),"eid"===e.provider&&!1===e.showEidVerification?i("div",{staticClass:"form-group"},[e._v(" Insert the eID card number:"),i("br"),i("br"),i("b-input",{attrs:{placeholder:"Insert card number"},model:{value:e.eidnumber,callback:function(t){e.eidnumber=t},expression:"eidnumber"}}),i("br"),i("a",{staticStyle:{display:"none"},attrs:{id:"downloadcid"}})],1):e._e(),"eid"===e.provider&&!0===e.showEidVerification?i("div",{staticClass:"form-group"},[e._v(" Sign your .cie file with your eID card and upload again the .p7m file:"),i("br"),i("br"),i("input",{ref:"file",attrs:{type:"file",id:"file"},on:{change:function(t){return e.loadP7mFromFile()}}}),i("br"),i("br")]):e._e(),i("div",{staticClass:"form-group row"},[i("div",{staticClass:"col-12"},["phone"!==e.provider&&"email"!==e.provider&&"eid"!==e.provider?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.submitVerification()}}},[e._v("Start verification with "+e._s(e.provider.toUpperCase()))]):e._e(),"phone"===e.provider&&!1===e.showSmsVerification?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.sendSMS()}}},[e._v("Send verification SMS")]):e._e(),"phone"===e.provider&&!0===e.showSmsVerification?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.verifySMS()}}},[e._v("Verify SMS")]):e._e(),"email"===e.provider&&!1===e.showEmailVerification?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.sendEmail()}}},[e._v("Send verification e-mail")]):e._e(),"email"===e.provider&&!0===e.showEmailVerification?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.verifyEMail()}}},[e._v("Verify e-mail")]):e._e(),"eid"===e.provider&&!1===e.showEidVerification?i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.createEidPayload()}}},[e._v("Create e-identity file")]):e._e(),i("br")],1)])])])]),e.updated?e._e():i("div",[e.success?i("div",{staticClass:"login-inner-form"},[i("img",{attrs:{src:"/success.png",width:"200"}}),i("br"),i("br"),e._v("You've successfully verified your "),i("b",[e._v(e._s(e.success.toUpperCase()))]),e._v(" account:"),i("br"),i("br"),void 0!==e.payload.identity.username?i("div",[i("b",[e._v("Username:")]),e._v(" "+e._s(e.payload.identity.username)),i("br")]):e._e(),void 0!==e.payload.identity.id?i("span",[i("b",[e._v("ID:")]),e._v(" "+e._s(e.payload.identity.id)),i("br"),i("br")]):e._e(),i("br"),"eid"===e.success?i("div",[i("b",[e._v("SUBJECT")]),e._v(": "+e._s(e.payload.identity.payload.subject)),i("br"),i("b",[e._v("eID NUMBER")]),e._v(": "+e._s(e.payload.identity.payload.id_number)),i("br"),i("b",[e._v("NAME")]),e._v(": "+e._s(e.payload.identity.payload.name)),i("br"),i("b",[e._v("SURNAME")]),e._v(": "+e._s(e.payload.identity.payload.surname)),i("br"),i("b",[e._v("ISSUED BY")]),e._v(": "+e._s(e.payload.identity.payload.issuer)),i("br"),i("b",[e._v("OFFICE")]),e._v(": "+e._s(e.payload.identity.payload.office)),i("br"),i("b",[e._v("COUNTRY")]),e._v(": "+e._s(e.payload.identity.payload.country)),i("br"),i("b",[e._v("P7M HASH")]),e._v(": "+e._s(e.payload.identity.payload.p7mhash)),i("br"),i("br")]):e._e(),e.isWriting?e._e():i("b-button",{attrs:{type:"is-primary"},on:{click:function(t){return e.writeIdentity()}}},[e._v("Write signature")]),e.isWriting?i("div",[e._v(" "+e._s(e.workingmessage)+" ")]):e._e()],1):e._e()]),e.updated?i("div",[i("div",{staticClass:"login-inner-form text-center"},[i("h1",[e._v("Process completed!")]),i("br"),i("br"),e._v(" Now is time to download your updated .sid file and sync your dApps and your extension!"),i("br"),e._v(" Please note, no one keeps your identity payload, only you can share it, these informations are not stored in any server."),i("br"),i("br"),i("a",{staticStyle:{display:"none"},attrs:{id:"downloadsid"}}),i("b-button",{staticStyle:{width:"100%"},attrs:{type:"is-primary"},on:{click:function(t){return e.downloadSidFile()}}},[e._v("Download .sid file")]),i("br"),i("br"),i("a",{attrs:{href:e.shareURL,target:"_blank"}},[i("b-button",{staticStyle:{width:"100%"},attrs:{type:"is-success"}},[e._v("SHARE IDENTITY")])],1),i("br"),i("br"),i("a",{attrs:{href:"/"}},[e._v("Go back")])],1)]):e._e()]):e._e()])])])])},n=[],a=(i("c975"),i("d3b7"),i("4d63"),i("ac1f"),i("25f0"),i("3ca3"),i("5319"),i("1276"),i("ddb0"),i("2b3d"),i("96cf"),i("1da1")),s=i("07c9"),o=i("bc3a"),c=i("470b"),d={name:"Home",data:function(){return{scrypta:new s(!0),backendURL:"",address:"",file:"",isWriting:!1,showSmsVerification:!1,showEmailVerification:!1,showEidVerification:!1,smsverification:"",emailverification:"",eidnumber:"",unlockPwd:"",showQRCanvas:!1,isGithub:!1,isGoogle:!1,isTwitter:!1,isLinkedin:!1,isEid:!0,isEmail:!1,isPhone:!1,provider:"eid",email:"",providers:[],phone:"",workingmessage:"",success:"",encrypted_wallet:"",public_qrcode:"",sync_qrcode:"",decrypted_wallet:"",linked:"",updated:"",axios:o,shareURL:"",payload:{identity:{username:"",id:""}}}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var i,r,n,a,s,o,c,d,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=document.URL,r=e,n=window.location.href,a=n.split("?"),r.backendURL=a[0].replace(":8080/",":3000/").replace("/#/","").replace(":3000/",":3000").replace(".id/",".id"),t.next=7,r.axios.get(r.backendURL+"/providers");case 7:return s=t.sent,o=s.data.providers,r.providers=o,t.next=12,e.checkUser();case 12:c=t.sent,!0===c&&-1!==i.indexOf("?")&&(d=i.split("?"),void 0!==d[1]&&(l=d[1].split("="),void 0!==l[1]&&"success"===l[1].replace("#","").replace("#/","").replace("/","")&&(r.success=l[0],r.axios.post(r.backendURL+"/auth/"+l[0]+"/session").then((function(e){void 0!==e.data.identity?r.payload=e.data:window.location="/"})))));case 14:case"end":return t.stop()}}),t)})))()},methods:{selectProvider:function(e){var t=this;t.provider=e,t.isGithub=!1,t.isGoogle=!1,t.isPhone=!1,t.isEmail=!1,t.isEid=!1,t.isLinkedin=!1,t.isTwitter=!1,"github"===e&&(t.isGithub=!0),"google"===e&&(t.isGoogle=!0),"twitter"===e&&(t.isTwitter=!0),"linkedin"===e&&(t.isLinkedin=!0),"email"===e&&(t.isEmail=!0),"phone"===e&&(t.isPhone=!0),"eid"===e&&(t.isEid=!0)},sendEmail:function(){var e=this;""!==e.email?e.axios.post(e.backendURL+"/email/send",{email:e.email}).then((function(t){!0===t.data.success&&(e.showEmailVerification=!0)})):alert("Write email first!")},verifyEMail:function(){var e=this;void 0!==e.emailverification?e.axios.post(e.backendURL+"/email/verify",{email:e.email,code:e.emailverification}).then((function(t){200===t.data.status?(e.success="email",e.payload=t.data.success):alert("Code is invalid!")})):alert("Write code first!")},sendSMS:function(){var e=this;""!==e.phone?e.axios.post(e.backendURL+"/phone/send",{number:e.phone}).then((function(t){!0===t.data.success&&(e.showSmsVerification=!0)})):alert("Write phone first!")},verifySMS:function(){var e=this;void 0!==e.smsverification?e.axios.post(e.backendURL+"/phone/verify",{number:e.phone,code:e.smsverification}).then((function(t){200===t.data.status?(e.success="phone",e.payload=t.data.success):alert("Code is invalid!")})):alert("Write code first!")},submitVerification:function(){var e=this;""!==e.provider&&document.getElementById("verificationForm").submit()},checkUser:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.scrypta.returnDefaultIdentity();case 2:if(i=t.sent,!i){t.next=8;break}return r=i.split(":"),e.address=r[0],e.encrypted_wallet=i,t.abrupt("return",!0);case 8:case"end":return t.stop()}}),t)})))()},downloadSidFile:function(){var e=document.getElementById("downloadsid"),t=new Blob([this.encrypted_wallet],{type:"sid"});e.href=URL.createObjectURL(t),e.download=this.address+".sid";var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});e.dispatchEvent(i)},writeIdentity:function(){var e=this;e.$buefy.dialog.prompt({message:"Enter wallet password",inputAttrs:{type:"password"},trapFocus:!0,onConfirm:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(i){var r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.scrypta.readKey(i,e.encrypted_wallet);case 2:r=t.sent,!1!==r?(e.isWriting=!0,n=r.prv,e.workingmessage="Signing identity with private key...",s={identity:e.payload.identity,fingerprint:e.payload.fingerprint},e.scrypta.signMessage(n,JSON.stringify(s)).then(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var a,o,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(void 0===r.identity&&(r.identity={}),r.identity[e.success]={},r.identity[e.success]=s,r.identity[e.success]!==s){t.next=15;break}return t.next=6,e.scrypta.buildWallet(i,e.address,r,!0);case 6:return t.next=8,e.scrypta.returnIdentity(e.address);case 8:return a=t.sent,t.next=11,e.scrypta.readKey(i,a.wallet);case 11:o=t.sent,o.identity[e.success].fingerprint===s.fingerprint?(e.encrypted_wallet=a.wallet,localStorage.setItem("SID",a.wallet),d={signature:n.signature,gateway:e.payload.gateway,fingerprint:e.payload.fingerprint},e.workingmessage="Uploading data to the blockchain...",e.scrypta.write(e.encrypted_wallet,i,JSON.stringify(d),"",e.success.toUpperCase(),"I://").then((function(t){void 0!==t.uuid&&t.txs.length>=1&&null!==t.txs[0]?(e.isWriting=!1,e.workingmessage="Data written correctly.",e.payload="",e.decrypted_wallet="WALLET LOCKED",e.updated=e.encrypted_wallet,setTimeout((function(){r.identity.address=e.address,r.identity.key=r.key;var t=c.deflateSync(JSON.stringify(r.identity)).toString("base64"),i="/",n=new RegExp(i,"g");t=t.replace(n,"*"),e.shareURL="https://me.scrypta.id/#/share/"+t,e.public_qrcode=t}),30)):(alert("There's an error in the upload, please retry!"),e.isWriting=!1)})).catch((function(){alert("There's an error in the upload, please retry!"),e.isWriting=!1}))):alert("Something goes wrong, retry please!"),t.next=16;break;case 15:alert("Something goes wrong, retry please!");case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())):e.$buefy.toast.open({message:"Wrong password!",type:"is-danger"});case 4:case"end":return t.stop()}}),t)})));function i(e){return t.apply(this,arguments)}return i}()})},createEidPayload:function(){var e=this,t=this;""!==t.eidnumber?t.$buefy.dialog.prompt({message:"Enter wallet password",inputAttrs:{type:"password"},trapFocus:!0,onConfirm:function(){var i=Object(a["a"])(regeneratorRuntime.mark((function i(r){var n,a,s,o,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.scrypta.readKey(r,t.encrypted_wallet);case 2:if(n=i.sent,!1===n){i.next=16;break}return i.next=6,t.scrypta.signMessage(n.prv,t.eidnumber);case 6:a=i.sent,s=document.getElementById("downloadcid"),o=new Blob([JSON.stringify(a)],{type:"cid"}),s.href=URL.createObjectURL(o),s.download=e.address+".cid",c=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}),t.showEidVerification=!0,s.dispatchEvent(c),i.next=17;break;case 16:t.$buefy.toast.open({message:"Wrong password!",type:"is-danger"});case 17:case"end":return i.stop()}}),i)})));function r(e){return i.apply(this,arguments)}return r}()}):alert("Write e-id card number first!")},loadP7mFromFile:function(){var e=this;e.file=e.$refs.file.files[0];var t=new FormData;t.append("file",e.file),t.append("address",e.address),t.append("eidnumber",e.eidnumber),o.post(e.backendURL+"/eid/verify",t,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){!1===t.data.error&&t.data.success.identity.payload.id_number===e.eidnumber?(e.success="eid",e.payload=t.data.success):!0===t.data.error&&alert(t.data.message)})).catch((function(){alert("Something goes wrong with backend please retry.")}))}}},l=d,u=(i("cccb"),i("2877")),p=Object(u["a"])(l,r,n,!1,null,null,null);t["default"]=p.exports},c975:function(e,t,i){"use strict";var r=i("23e7"),n=i("4d64").indexOf,a=i("a640"),s=i("ae40"),o=[].indexOf,c=!!o&&1/[1].indexOf(1,-0)<0,d=a("indexOf"),l=s("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:c||!d||!l},{indexOf:function(e){return c?o.apply(this,arguments)||0:n(this,e,arguments.length>1?arguments[1]:void 0)}})},cccb:function(e,t,i){"use strict";var r=i("5ced"),n=i.n(r);n.a}}]);
//# sourceMappingURL=home.dea4810c.js.map